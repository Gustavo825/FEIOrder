import{Q as K}from"./QChip.5b94b3ab.js";import{r as E,a as c,g as U,ac as M,h as p,W,c as Y,az as X,aQ as G,aA as H,aC as J,aR as Z,aY as ee,aS as B,aB as te,ab as le}from"./index.8d0d3872.js";import{h as ne}from"./format.2a3572e1.js";function b(e,f,y,h){const u=[];return e.forEach(s=>{h(s)===!0?u.push(s):f.push({failedPropValidation:y,file:s})}),u}function k(e){e&&e.dataTransfer&&(e.dataTransfer.dropEffect="copy"),W(e)}const ae={multiple:Boolean,accept:String,capture:String,maxFileSize:[Number,String],maxTotalSize:[Number,String],maxFiles:[Number,String],filter:Function},ie=["rejected"];function ue({editable:e,dnd:f,getFileInput:y,addFilesToQueue:h}){const{props:u,emit:s,proxy:F}=U(),x=E(null),z=c(()=>u.accept!==void 0?u.accept.split(",").map(t=>(t=t.trim(),t==="*"?"*/":(t.endsWith("/*")&&(t=t.slice(0,t.length-1)),t.toUpperCase()))):null),V=c(()=>parseInt(u.maxFiles,10)),_=c(()=>parseInt(u.maxTotalSize,10));function A(t){if(e.value)if(t!==Object(t)&&(t={target:null}),t.target!==null&&t.target.matches('input[type="file"]')===!0)t.clientX===0&&t.clientY===0&&M(t);else{const m=y();m&&m!==t.target&&m.click(t)}}function N(t){e.value&&t&&h(null,t)}function I(t,m,S,C){let n=Array.from(m||t.target.files);const d=[],g=()=>{d.length>0&&s("rejected",d)};if(u.accept!==void 0&&z.value.indexOf("*/")===-1&&(n=b(n,d,"accept",a=>z.value.some(r=>a.type.toUpperCase().startsWith(r)||a.name.toUpperCase().endsWith(r))),n.length===0))return g();if(u.maxFileSize!==void 0){const a=parseInt(u.maxFileSize,10);if(n=b(n,d,"max-file-size",r=>r.size<=a),n.length===0)return g()}if(u.multiple!==!0&&n.length>0&&(n=[n[0]]),n.forEach(a=>{a.__key=a.webkitRelativePath+a.lastModified+a.name+a.size}),C===!0){const a=S.map(r=>r.__key);n=b(n,d,"duplicate",r=>a.includes(r.__key)===!1)}if(n.length===0)return g();if(u.maxTotalSize!==void 0){let a=C===!0?S.reduce((r,T)=>r+T.size,0):0;if(n=b(n,d,"max-total-size",r=>(a+=r.size,a<=_.value)),n.length===0)return g()}if(typeof u.filter=="function"){const a=u.filter(n);n=b(n,d,"filter",r=>a.includes(r))}if(u.maxFiles!==void 0){let a=C===!0?S.length:0;if(n=b(n,d,"max-files",()=>(a++,a<=V.value)),n.length===0)return g()}if(g(),n.length>0)return n}function P(t){k(t),f.value!==!0&&(f.value=!0)}function i(t){W(t),t.relatedTarget!==x.value&&(f.value=!1)}function j(t){k(t);const m=t.dataTransfer.files;m.length>0&&h(null,m),f.value=!1}function O(t){if(f.value===!0)return p("div",{ref:x,class:`q-${t}__dnd absolute-full`,onDragenter:k,onDragover:k,onDragleave:i,onDrop:j})}return Object.assign(F,{pickFiles:A,addFiles:N}),{pickFiles:A,addFiles:N,onDragover:P,processFiles:I,getDndNode:O,maxFilesNumber:V,maxTotalSizeNumber:_}}var ce=Y({name:"QFile",inheritAttrs:!1,props:{...X,...G,...ae,modelValue:[File,FileList,Array],append:Boolean,useChips:Boolean,displayValue:[String,Number],tabindex:{type:[String,Number],default:0},counterLabel:Function,inputClass:[Array,String,Object],inputStyle:[Array,String,Object]},emits:[...H,...ie],setup(e,{slots:f,emit:y,attrs:h}){const{proxy:u}=U(),s=J(),F=E(null),x=E(!1),z=Z(e),{pickFiles:V,onDragover:_,onDragleave:A,processFiles:N,getDndNode:I}=ue({editable:s.editable,dnd:x,getFileInput:Q,addFilesToQueue:R}),P=ee(e),i=c(()=>Object(e.modelValue)===e.modelValue?"length"in e.modelValue?Array.from(e.modelValue):[e.modelValue]:[]),j=c(()=>B(i.value)),O=c(()=>i.value.map(l=>l.name).join(", ")),t=c(()=>ne(i.value.reduce((l,o)=>l+o.size,0))),m=c(()=>({totalSize:t.value,filesNumber:i.value.length,maxFiles:e.maxFiles})),S=c(()=>({tabindex:-1,type:"file",title:"",accept:e.accept,capture:e.capture,name:z.value,...h,id:s.targetUid.value,disabled:s.editable.value!==!0})),C=c(()=>"q-file q-field--auto-height"+(x.value===!0?" q-file--dnd":"")),n=c(()=>e.multiple===!0&&e.append===!0);function d(l){const o=i.value.slice();o.splice(l,1),a(o)}function g(l){const o=i.value.findIndex(l);o>-1&&d(o)}function a(l){y("update:modelValue",e.multiple===!0?l:l[0])}function r(l){l.keyCode===13&&le(l)}function T(l){(l.keyCode===13||l.keyCode===32)&&V(l)}function Q(){return F.value}function R(l,o){const v=N(l,o,i.value,n.value),q=Q();q!=null&&(q.value=""),v!==void 0&&((e.multiple===!0?e.modelValue&&v.every(L=>i.value.includes(L)):e.modelValue===v[0])||a(n.value===!0?i.value.concat(v):v))}function D(){return[p("input",{class:[e.inputClass,"q-file__filler"],style:e.inputStyle})]}function $(){if(f.file!==void 0)return i.value.length===0?D():i.value.map((o,v)=>f.file({index:v,file:o,ref:this}));if(f.selected!==void 0)return i.value.length===0?D():f.selected({files:i.value,ref:this});if(e.useChips===!0)return i.value.length===0?D():i.value.map((o,v)=>p(K,{key:"file-"+v,removable:s.editable.value,dense:!0,textColor:e.color,tabindex:e.tabindex,onRemove:()=>{d(v)}},()=>p("span",{class:"ellipsis",textContent:o.name})));const l=e.displayValue!==void 0?e.displayValue:O.value;return l.length>0?[p("div",{class:e.inputClass,style:e.inputStyle,textContent:l})]:D()}function w(){const l={ref:F,...S.value,...P.value,class:"q-field__input fit absolute-full cursor-pointer",onChange:R};return e.multiple===!0&&(l.multiple=!0),p("input",l)}return Object.assign(s,{fieldClass:C,emitValue:a,hasValue:j,inputRef:F,innerValue:i,floatingLabel:c(()=>j.value===!0||B(e.displayValue)),computedCounter:c(()=>{if(e.counterLabel!==void 0)return e.counterLabel(m.value);const l=e.maxFiles;return`${i.value.length}${l!==void 0?" / "+l:""} (${t.value})`}),getControlChild:()=>I("file"),getControl:()=>{const l={ref:s.targetRef,class:"q-field__native row items-center cursor-pointer",tabindex:e.tabindex};return s.editable.value===!0&&Object.assign(l,{onDragover:_,onDragleave:A,onKeydown:r,onKeyup:T}),p("div",l,[w()].concat($()))}}),Object.assign(u,{removeAtIndex:d,removeFile:g,getNativeElement:()=>F.value}),te(s)}});export{ce as Q};
